"use strict";angular.module("app",["ngAnimate","ngResource","ngSanitize","ngTouch","angularMoment","oc.lazyLoad","ui.router","app.config","ui.bootstrap","ui.bootstrap.datetimepicker","ui.grid.selection","ui.grid.resizeColumns","ui.grid.pagination","schemaForm","toastr","ngDialog","ui.grid.autoResize","ui.grid.exporter","app.controllers"]).run(["$log","$timeout","$state","$rootScope","amMoment","i18nService",function(e,t,n,r,o,i){i.setCurrentLang("zh-cn"),o.changeLocale("zh-cn")}]),angular.module("test",["ui.grid.pagination"]).run(["$log","$timeout","$state","$rootScope","amMoment","i18nService",function(e,t,n,r,o,i){i.setCurrentLang("zh-cn"),o.changeLocale("zh-cn")}]),angular.module("app.controllers",[]).controller("AppCtrl",["$scope","$location","$resource","$log","utils","$http","ENV",function(e,t,n,r,o,i,a){o.async("GET",a.menuApi,{}).then(function(n){var r=n.body;angular.isArray(r)||(r=r.items);var i=r.sort(function(e,t){return e.order-t.order});if(e.menus=o.initMenus(a.menuRoot,i),e.menus.length){var l=t.path().split("/").slice(1);"dashboard"===l[0]?e.menus[0].expanded=!0:e.menus.forEach(function(e){e.tag==l[0]?e.expanded=!0:1==e.expanded&&(e.expanded=!1)})}e.menusCache=o.buildMenuTree(i)}),e.onSelect=function(e,t,n){location.hash=e.url},e.getMenus=function(t){return e.menusCache.filter(function(e){return e.label.contains(t)})},e.displayName=localStorage.getItem("displayName"),e.action={logout:function(){o.async("GET","logout").then(function(e){localStorage.removeItem("displayName"),location.reload()},function(e){location.reload()})}}}]),angular.module("app").config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider","plugins",function(e,t,n,r,o){r.config({});e.state("app",{url:"","abstract":!0,templateUrl:o.templates.layout,controller:"AppCtrl"}).state("login",{url:"/login",templateUrl:o.templates.login,controller:"app.login.index"}).state("app.dashboard",{url:"/dashboard",views:{content:{templateUrl:function(){return o.templates.dashboard},controller:"app.dashboard.index"}}}).state("app.list",{url:"/:name/:page",views:{content:{templateUrl:function(){return o.templates.list},controller:"app.wrap.list"}},resolve:{deps:["$ocLazyLoad","$stateParams","$http","utils",function(e,t,n,r){return e.load(["plugins/"+t.name+"/config.js"]).then(function(e){return e},function(e){console.log(e)})}]}});t.otherwise("/dashboard")}]),angular.module("app").controller("app.root",["$scope","$stateParams","$location","settings","utils","menu",function(e,t,n,r,o,i){o.async("GET",r.runtime.menuApi,{}).then(function(t){var o=t.body;angular.isArray(o)||(o=o.items);var a=o.sort(function(e,t){return e.order-t.order});if(e.menus=i.initMenus(r.runtime.menuRoot,a),e.menus.length){var l=n.path().split("/").slice(1);"dashboard"===l[0]?e.menus[0].expanded=!0:e.menus.forEach(function(e){e.tag==l[0]?e.expanded=!0:1==e.expanded&&(e.expanded=!1)})}e.menusCache=i.buildMenuTree(a)}),e.onSelect=function(e,t,n){location.hash=e.url},e.getMenus=function(t){return e.menusCache.filter(function(e){return e.label.contains(t)})},e.displayName=localStorage.getItem("displayName"),e.action={logout:function(){o.async("GET","logout").then(function(e){localStorage.removeItem("displayName"),location.reload()},function(e){location.reload()})}}}]),angular.module("app").controller("app.dashboard.index",["$scope","$stateParams","utils","ENV","$log",function(e,t,n,r,o){var i=e;i.init=function(){},i.init()}]),angular.module("app").controller("app.wrap.list",["$scope","$stateParams","$timeout","$location","$log","$resource","$http","utils","explain","plugins","toastr",function(e,t,n,r,o,i,a,l,c,s,u){var f=e;f.action={search:function(){f.load()},reset:function(){angular.forEach(f.filter,function(e,t){"count"!=t&&delete f.filter[t]})},cancel:function(){angular.forEach(f.form.model,function(e,t){delete f.form.model[t],console.log(f.form.feedback)})},del:function(){var e=f.gridApi.selection.getSelectedRows()||[],n=0;e.length?angular.forEach(e,function(r){var o=[t.name,t.page].join("/");l.async("delete",o+"/"+r.uid).then(function(t){f.load(),n++,n==e.length&&(u.success("删除成功！"),n=0)})}):u.warning("请选中要删除的数据")},create:function(){f.detailLoad(),f.form.schema||(f.scaffold=!0,f.form.model={type:"object",properties:[]},angular.forEach(f.headers,function(e,t){var n={};n.key=t,n.title=e,n.type="string",f.form.model.properties.push(n)}),f.form.schema={type:"object",properties:{properties:{type:"array",title:"字段设置",items:{type:"object",title:"属性名称",properties:{title:{type:"string",title:"名称"},required:{type:"boolean",title:"是否必填"},type:{type:"string",title:"类型","enum":["string","boolean","object"]},partten:{type:"string",title:"验证正则"},placeholder:{type:"string",title:"placeholder"}}}}}}),l.disableScroll()},save:function(e){if(f.$broadcast("schemaFormValidate"),e.$valid){var n=[t.name,t.page].join("/"),r=f.form.model.uid?"put":"post";if("put"==r&&(n=[n,f.form.model.uid].join("/"),delete f.form.model["new"]),f.form.model)for(var o in f.form.model)f.form.model.hasOwnProperty(o)&&angular.isDate(f.form.model[o])&&(f.form.model[o]=moment(f.form.model[o]).format("YYYY-MM-DD HH:mm:ss"));l.async(r,n,f.form.model).then(function(e){f.load(),f.events.trigger("closeDetail"),f.events.trigger("entrySaved")})}else angular.element(".help-block").addClass("text-right")},close:function(){f.events.trigger("closeDetail")},bulk:function(){return f.gridApi.selection.getSelectedRows()||[]}},f.events=l.createEvents();var p=c.configuration(f),g=p.list.pageSize;f.init=function(){f.entries=[],f.filter={count:g},f.form=p.form,f.config=p,f.load(),f.events.trigger("listInit")},f.load=function(){var n=[t.name,t.page].join("/");l.async("GET",n,f.filter).then(function(t){var n=t.body;if(f.entries=n.items||[],f.headers=p.list.headers||n.headers,f.headers){var r=[];angular.forEach(f.headers,function(e,t){var n=angular.isObject(e)?e:{name:t,displayName:e};if(n.name=t,"json"==t){n.displayName="预约的手机号码",n.cellTemplate='<div class="ui-grid-cell-contents" title="{{row.entity.json }}">{{ row.entity.json | jsonParse:"phoneNumbers" }}</div>',r.push(n);var o={name:t+"2",displayName:e};o.displayName="预约的短信内容",o.cellTemplate='<div class="ui-grid-cell-contents" title="{{row.entity.json }}">{{ row.entity.json | jsonParse:"message" }}</div>',r.push(o)}else r.push(n)}),f.gridOptions.columnDefs=r,n.count>f.paginationOptions.pageSize?(e.height=30*f.paginationOptions.pageSize+90,f.gridOptions.minRowsToShow=f.paginationOptions.pageSize,setTimeout(function(){angular.element(window).trigger("resize")},500)):(e.height=30*n.count+90>460?30*n.count+90:460,f.gridOptions.minRowsToShow=n.count,setTimeout(function(){angular.element(window).trigger("resize")},500))}f.gridOptions.totalItems=n.count,f.form.debug&&f.entries.length&&f.detailLoad(f.entries[0])})},f.detailLoad=function(e){e||(e={}),f.entryCopy=angular.copy(e),f.detailUid=e.uid,f.form=f.form||{},f.form.model=e,f.detailUrl=p.form.template,l.disableScroll(),f.events.trigger("detailLoad",e)},f.paginationOptions={pageNumber:1,pageSize:g,sort:null},f.gridOptions={data:"entries",enableGridMenu:!0,exporterMenuCsv:!0,enablePaginationControls:!0,enableFiltering:!1,enableRowHeaderSelection:!0,exporterOlderExcelCompatibility:!0,onRegisterApi:function(t){f.gridApi=t,t.pagination.on.paginationChanged(e,function(e,t){f.filter.start=(e-1)*t,f.filter.count=t,f.load(),f.paginationOptions.pageNumber=e,f.paginationOptions.pageSize=t})},selectedItems:[],paginationPageSizes:[g,200,1e3],paginationPageSize:g,virtualizationThreshold:1e3,appScopeProvider:{onDblClick:function(e){f.detailLoad(e.entity)}},rowTemplate:'<div ng-dblclick="grid.appScope.onDblClick(row)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>'},f.events.on("closeDetail",function(){f.detailUrl=null,f.form.model={},l.resetScroll()}),f.init()}]),angular.module("app").controller("app.login.index",["$scope","$stateParams","$location","$resource","utils","ENV",function(e,t,n,r,o,i){e.filter={},e.login=function(){o.async("POST",i.apiPath+"/login",e.filter).then(function(t){localStorage.setItem("displayName",t.body.displayName||t.body.name),localStorage.setItem("username",e.filter.username),localStorage.setItem("password",e.filter.password);var r=decodeURIComponent(n.search()["return"]);r&&(location.hash=r),n.search("return",null)},function(e){o.alert(e.message)})}}]),angular.module("app").controller("app.selector",["$scope","utils","$ionicModal",function(e,t,n){function r(e,t,n){for(var o=t.u_id.split("_"),i="",a=0;n>=a;a++)i+=o[a],a!=n&&(i+="_");var l=e.filter(function(e){return i==e.u_id});l=l[0],n+2==o.length?(l.tree||(l.tree=[]),l.tree.push(t)):r(l.tree,t,++n)}function o(e){e&&e.forEach(function(e){e.check&&(e.check=!1),o(e.tree)})}function i(e,t){e&&e.forEach(function(e){e.check!=t&&(e.check=t),i(e.tree,e.check)})}function a(e,t){for(var n=0,r=e.length;r>n;n++){var o=e[n];if(o.u_id==t)return o;if(o.tree){var i=a(o.tree,t);if(i)return i}}}function l(e,t){t.forEach(function(t){t.check&&e.push(t),t.tree&&l(e,t.tree)})}function c(e,t){t.forEach(function(t){t.check&&e.push(t),!t.check&&t.tree&&c(e,t.tree)})}var s=e.search=e.$parent.selectors[e.$parent.currentName].search;e.count=0,e.loadDepartment=function(){t.async("GET","/api/department/all",{count:999999}).then(function(t){var n=t.items,o=[];n.forEach(function(e){var t=e.u_id;e.name=e.u_lname,-1==t.indexOf("_")?o.push(e):r(o,e,0)}),e.items=o},function(e){})},e.check=function(t){if(s.radio)t.check||o(e.items);else if(t.check){var n=t.u_id.split("_");n.pop();var r=n.join("_"),l=a(e.items,r);if(l&&l.check)return}t.check=!t.check,i(t.tree,t.check);var u=[];c(u,e.items),e.count=u.length};var u=null;e.back=function(){u.hide()},e.goAlreadySelect=function(){var t=[];c(t,e.items),e.topSelected=t,u?u.show():n.fromTemplateUrl("base/templates/s.alreadySelect.html",{scope:e}).then(function(e){u=e,u.show()})},e.okay=function(){var t=[];l(t,e.items);var n=[];c(n,e.items);var r=[],o=[];t.forEach(function(e){o.push(e.uid)}),n.forEach(function(e){r.push(e.name)}),e.$parent.departmentOkay(o,r)},e.cancel=function(){e.$parent.cancel()}}]),function(){angular.module("app").directive("changeTab",function(e){return{restrict:"A",link:function(e,t,n){$(t).click(function(e){$(this).parents(".tabbable").find(".active").removeClass("active"),$($(this).attr("change-tab")).addClass("active"),$(this).addClass("active"),e.stopPropagation()})}}}).directive("boxChangeShowHide",function(){return{restrict:"A",link:function(e,t,n){$(t).click(function(e){var t=$(this).children();t.hasClass("fa-chevron-up")?t.removeClass("fa-chevron-up").addClass("fa-chevron-down").parents(".util-box:eq(0)").children(".box-body").hide():t.removeClass("fa-chevron-down").addClass("fa-chevron-up").parents(".util-box:eq(0)").children(".box-body").show(),e.stopPropagation()})}}}).directive("onDomReady",function(e){return{restrict:"A",link:function(t,n,r){e(function(){var e=angular.element("#sidebar");n.on("click",".navbar-toggle.menu-toggler",function(t){var n=angular.element(this);n.toggleClass("display"),e.toggleClass("display"),t.stopPropagation()}),n.on("click",".toggle-open",function(e){angular.element(this).toggleClass("open"),e.stopPropagation()}),n.on("click",function(){angular.element(".toggle-open").removeClass("open")}),n.on("click",".tabbable.tabs-left li",function(e){var t=angular.element(this);angular.element(".tabbable.tabs-left li").not(t).removeClass("active"),t.addClass("active");var r=t.attr("id"),o=angular.element("#tab_"+r);n.parent().find(".tab-pane").removeClass("active"),o.addClass("active"),e.stopPropagation()})})}}}).directive("onFinishRender",function(e){return{restrict:"A",link:function(t,n,r){t.$last===!0&&e(function(){t.$emit("ngRepeatFinished")})}}}).directive("onMenuRender",function(e,t){return{restrict:"A",link:function(n,r,o){n.$last===!0&&e(function(){var e=t.page,n=$("a[href$="+e+"]");n.parent().addClass("active"),n.parent().hasClass("last-menu")&&n.parents("li.ng-scope").addClass("open"),r.parent().on("click","li",function(e){var t=angular.element(this);t.hasClass("last-menu")&&(t.parents("li").siblings().removeClass("active"),$(".last-menu").not(this).removeClass("active")),t.children().children().hasClass("last-menu")?t.toggleClass("open"):t.hasClass("last-menu")?t.addClass("active").siblings().removeClass("active"):(t.addClass("active").siblings().removeClass("active"),$(".last-menu").removeClass("active")),t.hasClass("open")?t.children(".submenu").show():t.children(".submenu").hide(),e.stopPropagation()})})}}}).directive("onSideBarRender",function(e){return{restrict:"A",link:function(t,n,r){e(function(){n.on("click","#sidebar-collapse",function(){n.toggleClass("menu-min"),n.find(".tabbable.tabs-left").toggleClass("hidden-ele"),angular.element("#sidebar-collapse").find("i").toggleClass("fa-angle-double-right")})})}}}).directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,n){t.replaceWith(t.children())}}}).directive("pageBar",["$location","utils",function(e,t){return{restrict:"EA",templateUrl:"base/templates/page-bar.html",replace:!0,scope:{conf:"="},link:function(n,r,o){function i(){if(null!=n.conf.totalItems){n.conf.currentPage=parseInt(n.conf.currentPage)?parseInt(n.conf.currentPage):1,n.conf.totalItems=parseInt(n.conf.totalItems),n.conf.itemsPerPage=parseInt(n.conf.itemsPerPage)?parseInt(n.conf.itemsPerPage):15,n.conf.numberOfPages=Math.ceil(n.conf.totalItems/n.conf.itemsPerPage),n.conf.currentPage<1&&(n.conf.currentPage=1),n.conf.currentPage>n.conf.numberOfPages&&(n.conf.currentPage=n.conf.numberOfPages),n.jumpPageNum=n.conf.currentPage;for(var e,t=n.conf.perPageOptions.length,r=0;t>r;r++)n.conf.perPageOptions[r]==n.conf.itemsPerPage&&(e=!0);if(e||n.conf.perPageOptions.push(n.conf.itemsPerPage),n.conf.perPageOptions.sort(function(e,t){return e-t}),n.pageList=[],n.conf.numberOfPages<=n.conf.pagesLength)for(r=1;r<=n.conf.numberOfPages;r++)n.pageList.push(r);else{var o=(n.conf.pagesLength-1)/2;if(n.conf.currentPage<=o){for(r=1;o+1>=r;r++)n.pageList.push(r);n.pageList.push("..."),n.pageList.push(n.conf.numberOfPages)}else if(n.conf.currentPage>n.conf.numberOfPages-o){for(n.pageList.push(1),n.pageList.push("..."),r=o+1;r>=1;r--)n.pageList.push(n.conf.numberOfPages-r);n.pageList.push(n.conf.numberOfPages)}else{for(n.pageList.push(1),n.pageList.push("..."),r=Math.ceil(o/2);r>=1;r--)n.pageList.push(n.conf.currentPage-r);for(n.pageList.push(n.conf.currentPage),r=1;o/2>=r;r++)n.pageList.push(n.conf.currentPage+r);n.pageList.push("..."),n.pageList.push(n.conf.numberOfPages)}}n.conf.onChange&&n.conf.onChange(),n.conf.currentPage<1&&(n.conf.currentPage=1)}}n.conf=n.conf||{},n.conf.currentPage=t.currentPage(),n.changeCurrentPage=function(t){return"..."==t?null:(n.conf.currentPage=t,void e.search("p",t))},n.conf.pagesLength=parseInt(n.conf.pagesLength)?parseInt(n.conf.pagesLength):9,n.conf.pagesLength%2===0&&(n.conf.pagesLength=n.conf.pagesLength-1),n.conf.perPageOptions||(n.conf.perPageOptions=[10,15,20,30,50]),n.prevPage=function(){n.conf.currentPage>1&&(n.conf.currentPage-=1)},n.nextPage=function(){n.conf.currentPage<n.conf.numberOfPages&&(n.conf.currentPage+=1)},n.jumpToPage=function(){n.jumpPageNum=n.jumpPageNum.replace(/[^0-9]/g,""),""!==n.jumpPageNum&&(n.conf.currentPage=n.jumpPageNum)},n.changeItemsPerPage=function(){},n.$watch("conf.totalItems",i)}}}]).directive("searchCommon",function(e){return{restrict:"EA",templateUrl:e.templates.searchCommon,replace:!0,scope:{filtersConf:"=",filter:"=",onSearch:"&",operations:"="},link:function(e,t,n){},controller:["$scope","$attrs","$element","$rootScope","$timeout","$modal",function(e,t,n,r,o,i){function a(){e.filtersConf&&e.filtersConf.forEach(function(t){if("select"==t.type)null==e.filter[t.name]&&(e.filter[t.name]=""),e.selectChange(t);else if("department"==t.type||"people"==t.type){var n=null;"department"==t.type?n="base/templates/s.department.html":"people"==t.type&&(n="base/templates/s.people.html"),e.selectors[t.name]={turl:n,search:t}}})}e.selectChange=function(t){e.filtersConf.forEach(function(t){t.hide&&(t.hide=!1,t.lastValue?e.filter[t.name]=t.lastValue:delete e.filter[t.name])}),angular.forEach(t.options,function(n){n.hideKeys&&n.value==e.filter[t.name]&&n.hideKeys.split(",").forEach(function(t){e.filtersConf.forEach(function(n){n.name==t&&1!=n.hide&&(n.lastValue=e.filter[n.name],delete e.filter[n.name],n.hide=!0)})})})},e.selectors={},e.$watch("filtersConf",function(){a()}),e.dateChange=function(t){e.filter[t]&&(e.filter[t]=moment(e.filter[t]).format("YYYY-MM-DD"))},e.openDate=function(e,t){e.preventDefault(),e.stopPropagation(),t.opened=!0},e.reset=function(){e.filtersConf.forEach(function(e){e.lastValue=null}),e.filtersConf.forEach(function(t){"select"==t.type?(e.filter[t.name]="",e.selectChange(t)):delete e.filter[t.name]})},e.keyDown=function(t){var n=t||window.event;n&&13==n.keyCode&&e.onSearch()}}]}})}(),function(){angular.module("app").directive("importUploader",["$location","utils","$log","FileUploader",function(e,t,n,r){return{restrict:"EA",templateUrl:"base/templates/import.html",replace:!0,scope:{options:"="},controller:["$scope","$attrs","$element",function(e,n,o){var i=e.options||{};e.title=i.title;var a=i.url||"/upload";a=t.getAbsUrl(a);var l=e.uploader=new r({url:a});l.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),l.onSuccessItem=function(t,n,r,o){e.message=n.message,angular.isFunction(i.resolve)&&i.resolve.apply()}}]}}])}(),function(){angular.module("app").directive("uploaderContainer",["$location","utils","$log",function(e,t,n){return{restrict:"EA",templateUrl:"base/templates/uploader-container.html",replace:!0,scope:{options:"="},controller:["$scope","$attrs","$element",function(e,n,r){var o=e.options,i=o.url||"/upload";i=t.getAbsUrl(i);var a=e.uploader=new FileUploader({url:i});a.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),angular.isFunction(o.resolve)&&o.resolve.apply(a)}]}}])}(),angular.module("app").factory("authInterceptor",["$rootScope","$q","$window","$location",function(e,t,n,r){var o=!0;return{request:function(e){return e},response:function(e){return e||t.when(e)},responseError:function(e){return 401===e.status&&o&&(o=!1,r.path("/login").search("return",encodeURIComponent(location.hash)),setTimeout(function(){o=!0},12e3)),t.reject(e)}}}]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.interceptors.push("authInterceptor")}]),angular.module("app").factory("explain",["$stateParams","oPath","ENV","plugins","utils",function(e,t,n,r,o){var i=angular.element(document.body).injector(),a=function(e,t){for(var n={},r=0;r<e.length;++r)e[r].hasOwnProperty(t)?n[e[r][t]]=e[r]:n[r]=e[r];return n},l=function(e,t){try{return i.get(e+".config")[t]}catch(n){return null}},c=function(e,t){angular.isFunction(e)?i.invoke(e,t):angular.isArray(e)&&angular.forEach(e,function(e){c(e,t)})},s=function(e,n){var r=t.get(e,"operation",[]);if(!r)return e;var o=[],a={add:{name:"新建",action:n.action.create},del:{name:"删除",action:n.action.del}},l={scope:n};return angular.forEach(r,function(e,t){if(e){var n=a[t]||{name:e.name,action:e.action};angular.isFunction(e.action)&&(n.action=function(){i.invoke(e.action,l)}),o.push(n)}}),e.operations=o,e},u=function(e,n){var r={scope:n,list:e.list},o=t.get(e,"list.resolves",[]);return c(o,r),e},f=function(e,t,n){e&&(e[t]=e[t]||angular.copy(n))},p=function(e,t){if(!e)throw"can not override properties with null";for(var n in t)t.hasOwnProperty(n)&&f(e,n,t[n])},g=function(e,n){var r=t.get(e,"schema.properties",{});angular.isArray(r)&&(e.schema.properties=a(r,"key"));var o={scope:n,form:e.form};angular.isArray(e.form)&&angular.forEach(e.form,function(t){angular.forEach(t.items,function(t){("datepicker"==t.type||"datetimepicker"==t.type)&&(t.title=t.title||e.schema.properties[t.key].title,t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!0}),angular.isObject(t)&&(t.required=t.required||e.schema.properties[t.key].required)})});var i=t.get(e,"resolves",[]);return c(i,o),e},d=function(t){if(!angular.isUndefined(t)){if(0==t.indexOf("http")||t.indexOf("plugins")>-1)return t;var r=[n.pluginFolder,e.name,"templates",t].join("/").replace(/\/\//g,"/");return[o.root,r].join("/")}},m=function(){var t=l(e.name,"_default")||{};return t=angular.extend({list:{},form:{}},t),f(t.form,"template",[o.root,r.templates.detail].join("/")),f(t.list,"template",[o.root,r.templates.list].join("/")),f(t.list,"pageSize",n.pageSize["default"]),t};return{configuration:function(t){var n=m(),r=l(e.name,e.page)||{};return f(r,"form",{}),f(r,"list",{}),p(r.form,n.form),p(r.list,n.list),r.list.template=d(r.list.template),r.form.template=d(r.form.template),r=s(r,t),r=u(r,t),r.form=g(r.form,t),r}}}]),angular.module("app").factory("fileSize",function(){function e(e,t){return e&&e.toLowerCase()===t.toLowerCase()}var t="BKMGTPEZY".split("");return function(n,r){return n="number"==typeof n?n:0,r=r||{},r.fixed="number"==typeof r.fixed?r.fixed:2,r.spacer="string"==typeof r.spacer?r.spacer:" ",r.calculate=function(t){var o,i=e(t,"si")?["k","B"]:["K","iB"],a=e(t,"si")?1e3:1024,l=Math.log(n)/Math.log(a)|0,c=n/Math.pow(a,l),s=c.toFixed(r.fixed);return 3>l-1&&!e(t,"si")&&e(t,"jedec")&&(i[1]="B"),o=l?(i[0]+"MGTPEZY")[l-1]+i[1]:1===(0|s)?"Byte":"Bytes",{suffix:o,magnitude:l,result:c,fixed:s,bits:{result:c/8,fixed:(c/8).toFixed(r.fixed)}}},r.to=function(r,o){var i=e(o,"si")?1e3:1024,a=t.indexOf("string"==typeof r?r[0].toUpperCase():"B"),l=n;if(-1===a||0===a)return l.toFixed(2);for(;a>0;a--)l/=i;return l.toFixed(2)},r.human=function(e){var t=r.calculate(e);return t.fixed+r.spacer+t.suffix},r}}),angular.module("app").factory("oPath",[function(){var e=function(){function e(e){if(!e)return!0;if(i(e)&&0===e.length)return!0;if(!r(e)){for(var t in e)if(f.call(e,t))return!1;return!0}return!1}function t(e){return u.call(e)}function n(e){return"number"==typeof e||"[object Number]"===t(e)}function r(e){return"string"==typeof e||"[object String]"===t(e)}function o(e){return"object"==typeof e&&"[object Object]"===t(e)}function i(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===t(e)}function a(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function l(e){var t=parseInt(e);return t.toString()===e?t:e}function c(t,o,i,a){if(n(o)&&(o=[o]),e(o))return t;if(r(o))return c(t,o.split(".").map(l),i,a);var s=o[0];if(1===o.length){var u=t[s];return void 0!==u&&a||(t[s]=i),u}return void 0===t[s]&&(t[s]=n(o[1])?[]:{}),c(t[s],o.slice(1),i,a)}function s(t,o){if(n(o)&&(o=[o]),e(t))return void 0;if(e(o))return t;if(r(o))return s(t,o.split("."));var a=l(o[0]),c=t[a];if(1===o.length)void 0!==c&&(i(t)?t.splice(a,1):delete t[a]);else if(void 0!==t[a])return s(t[a],o.slice(1));return t}var u=Object.prototype.toString,f=Object.prototype.hasOwnProperty,p=function(e){return Object.keys(p).reduce(function(t,n){return"function"==typeof p[n]&&(t[n]=p[n].bind(p,e)),t},{})};return p.has=function(t,a){if(e(t))return!1;if(n(a)?a=[a]:r(a)&&(a=a.split(".")),e(a)||0===a.length)return!1;for(var l=0;l<a.length;l++){var c=a[l];if(!o(t)&&!i(t)||!f.call(t,c))return!1;t=t[c]}return!0},p.ensureExists=function(e,t,n){return c(e,t,n,!0)},p.set=function(e,t,n,r){return c(e,t,n,r)},p.insert=function(e,t,n,r){var o=p.get(e,t);r=~~r,i(o)||(o=[],p.set(e,t,o)),o.splice(r,0,n)},p.empty=function(t,l){if(e(l))return t;if(e(t))return void 0;var c,s;if(!(c=p.get(t,l)))return t;if(r(c))return p.set(t,l,"");if(a(c))return p.set(t,l,!1);if(n(c))return p.set(t,l,0);if(i(c))c.length=0;else{if(!o(c))return p.set(t,l,null);for(s in c)f.call(c,s)&&delete c[s]}},p.push=function(e,t){var n=p.get(e,t);i(n)||(n=[],p.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},p.coalesce=function(e,t,n){for(var r,o=0,i=t.length;i>o;o++)if(void 0!==(r=p.get(e,t[o])))return r;return n},p.find=function(t,o,a){if(n(o)&&(o=[o]),e(o))return t;if(e(t))return a;r(o)&&p.find(t,o.split("."),a);var c=l(o[0]);if(/\[(.*?)\]/g.test(c)&&i(t))for(var s=/\[(.*?)\]/g.exec(c)[1],u=s.split(":"),f=0;f<t.length;f++)if(t[f].hasOwnProperty(u[0])&&t[f][u[0]]==u[1])return p.find(t[f],o.slice(1),a);return 1===o.length?void 0===t[c]?a:t[c]:p.find(t[c],o.slice(1),a)},p.get=function(t,o,i){if(n(o)&&(o=[o]),e(o))return t;if(e(t))return i;if(r(o))return p.get(t,o.split("."),i);var a=l(o[0]);return 1===o.length?void 0===t[a]?i:t[a]:p.get(t[a],o.slice(1),i)},p.del=function(e,t){return s(e,t)},p}();return e}]),angular.module("app").factory("utils",["$http","$q","$location","$stateParams","ENV","gateway","ngDialog",function(e,t,n,r,o,i,a){var l=o.headers,c={async:function(n,r,o,i){var a={method:n,url:r,cache:!1,headers:i||l};o&&angular.forEach(o,function(e,t){""==e&&delete o[t]}),o&&("post"==n.toLowerCase()||"put"==n.toLowerCase())&&l["Content-Type"].indexOf("json")>0?a.data=o:o&&(a.data=this.serialize(o));var s=t.defer();return r?(a.data&&"get"==a.method.toLowerCase()&&(a.url=a.url+"?"+a.data),e(a).success(function(e){if(0!=e.error&&e.error)if(e["@timestamp"]){var t=c.parseView(e);s.resolve({items:t})}else s.reject(e.message?e:{message:"服务器异常"});else s.resolve(e)}).error(function(e){s.reject({message:"无法连接到服务器"})}),s.promise):void s.reject({message:"Uri is empty!"})},serialize:function(e){if(!angular.isObject(e))return null==e?"":e.toString();var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];angular.isDate(r)&&moment&&(r=moment(r).format("YYYY-MM-DD HH:mm:ss")),t.push(encodeURIComponent(n)+"="+encodeURIComponent(null==r?"":r))}var o=t.join("&");return o},createDoc:function(e){return e&&e.properties&&angular.isArray(e.properties)&&(angular.forEach(e.properties,function(t){e[t.name]=1==t.value.length?t.value[0]:t.value}),delete e.properties),e}},s={"default":"ico ico-file ico-file-1",xls:"ico ico-file ico-file-2",xlsx:"ico ico-file ico-file-2",doc:"ico ico-file ico-file-3",docx:"ico ico-file ico-file-3",ppt:"ico ico-file ico-file-4",pptx:"ico ico-file ico-file-4",rar:"ico ico-file ico-file-6",zip:"ico ico-file ico-file-7",html:"ico ico-file ico-file-10",js:"ico ico-file ico-file-11",xml:"ico ico-file ico-file-12",css:"ico ico-file ico-file-12",pdf:"ico ico-file ico-file-17",txt:"ico ico-file ico-file-22",jpg:"ico ico-file ico-file-31",gif:"ico ico-file ico-file-32",png:"ico ico-file ico-file-33",bmp:"ico ico-file ico-file-34"},u=function(e,t){return t.filter(function(n){var r=n.parent==e&&n.type&&"menu"==n.type.toLowerCase();return"#"==n.url&&(n.url=""),0!=n.url.indexOf(o.serverRoot)&&0===n.url.indexOf("/")&&""!=o.serverRoot&&(n.url=o.serverRoot+n.url),r&&(n.subMenus=u(n.uid,t)),r})},f=function(e){var t=[];return angular.forEach(e,function(n){var r={label:n.name,url:n.url,parent:n.parent,uid:n.uid};r.parents=[],p(r,r,e),r.name=r.parents.reverse().join(" > "),t.push(r)}),t},p=function(e,t,n){var r=n.filter(function(e){return e.uid==t.parent});0==e.parents.length&&e.parents.push(e.label),r.length&&(e.parents.push(r[0].name),p(e,r[0],n))},g=function(){var e={};return{on:function(t,n){return t.split(" ").forEach(function(t){e[t]||(e[t]=[]),e[t].push(n)}),this},once:function(t,n){return t.split(" ").forEach(function(t){e[t]=[],e[t].push(n)}),this},trigger:function(t,n){return angular.forEach(e[t],function(e){e.call(null,n)}),this}}},d=new g,m=function(e){try{return angular.element(document.body).injector().get(e)}catch(t){return null}},h="self"!==i.host?i.host:location.protocol+"//"+location.host,v=h+location.pathname.substr(0,location.pathname.lastIndexOf("/")),y=function(e){var t=e.split("/");return o.mock&&t.length?"data/"+t.slice(3).join(".")+".json":e},b=function(e){var t=e;return 0==e.indexOf("http")?t=e:(0!==e.indexOf(o.apiPath)&&(t=[o.apiPath,e].join("/").replace(/\/\//g,"/")),t=[h,t].join("/")),t};return{alert:function(e,t){console.log(e,t)},root:v,host:h,getAbsUrl:b,serialize:c.serialize,format:function(e){var t=Array.prototype.slice.call(arguments,1);return e?e.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e}):""},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},createEvents:function(){return new g},events:d,initMenus:u,buildMenuTree:f,changeTitle:function(e){d.trigger("changeTitle",e)},currentPage:function(){var e=n.search()[e];return parseInt(e)||1},async:function(e,t,n){var r=b(t);return r=y(r),c.async(e,r,n)},findViewConfig:function(e,t){return m(e+".config")[t]},disableScroll:function(){document.body.style.overflow="hidden",angular.element(window).trigger("resize")},resetScroll:function(){document.body.style.overflow=null,angular.element(window).trigger("resize")},getFileExtCss:function(e){var t=/(?:\.([^.]+))?$/,n=t.exec(e)[1];return s.hasOwnProperty(n)?s[n]:s["default"]},dialogUpload:function(e){a.open({template:"base/templates/dialog-container.html",controller:function(t){t.options=e}})}}}]),angular.module("app").filter("stringify",function(){return function(e){return angular.isObject(e)?JSON.stringify(e):e}}).filter("now",function(){return function(e){return moment(e).format("LLL")}}).filter("jsonParse",function(){return function(e){if(angular.isString(e)&&2==arguments.length&&0==e.indexOf("{")){var t=[],n=JSON.parse(e);return angular.forEach(arguments[1].split(","),function(e){t.push(n[e])}),t.join(";")}return e}}).filter("protocol",function(){return function(e){return/^\/\//gi.test(e)?"https:"+e:e}});